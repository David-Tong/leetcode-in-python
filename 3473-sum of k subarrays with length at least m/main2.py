class Solution(object):
    def maxSum(self, nums, k, m):
        """
        :type nums: List[int]
        :type k: int
        :type m: int
        :rtype: int
        """
        # pre-process
        L = len(nums)

        presums = [0]
        for num in nums:
            presums.append(presums[-1] + num)

        # use dp to get maximal sums between nums[x:y+1]
        # dp init
        # sums[x][y] - the maximal sum between nums[x:y+1]
        sums = [[float("-inf")] * L for _ in range(L)]
        for z in range(k , L + 1):
            for x in range(L):
                y = x + z - 1
                if y < L:
                    sums[x][y] = presums[y + 1] - presums[x]
        # print(sums)

        # dp transfer
        # sums[x][y] - the maximal of its subarray with length of l - 1 and itself presums
        for z in range(k + 1, L + 1):
            for x in range(L):
                y = x + z - 1
                if y < L:
                    for xp in range(x, y + 1):
                        yp = xp + z - 2
                        if yp <= y:
                            sums[x][y] = max(sums[x][y], sums[xp][yp])
        # print(sums)

        # process
        # dp init
        # dp[x][y] - the maximum sum of y non-overlapping sub arrays of nums[:x]
        dp = [[float("-inf")] * (m + 1) for _ in range(L + 1)]
        for x in range(L + 1):
            dp[x][0] = 0

        # dp transfer
        # dp[x][y] = dp[xp][y - 1] for xp in [0, x - k]
        for x in range(1, L + 1):
            for y in range(m):
                for z in range(x - k + 1):
                    dp[x][y + 1] = max(dp[x][y + 1], dp[z][y] + sums[z][x - 1])
        # print(dp)
        ans = dp[L][m]
        return ans


nums = [1,2,-1,3,3,4]
k = 2
m = 2

nums = [-10,3,-1,-2]
k = 4
m = 1

nums = [1,2,-10,9,5,-15,13,7,8,8,-15,25]
k = 4
m = 3

"""
from random import randint
nums = [randint(-1 * 10 ** 4, 10 ** 4) for _ in range(2000)]
print(nums)
k = 532
m = 3
"""

nums = [1935, 4533, 1818, 7735, 3022, -3725, 8231, -4002, 4414, -5726, -1259, 7769, 8094, 7778, -9319, -7196, -2395, -2726, -322, 3671, 1248, -5964, 8112, 5362, 7317, -2992, -2556, -1196, 103, 1540, 6667, -6103, 3015, -4364, 1906, -4272, -6759, -8531, 8354, 7544, -7020, 4730, 3715, 8516, -2458, 5803, -6894, 9838, -9497, -3969, 4921, 630, -2098, -385, 2996, 6156, 499, -7618, 8144, -1219, -314, -5370, 4271, 7914, 5185, 1371, 5708, -4020, 8115, -3048, -2645, 9316, -9625, 2142, 4546, 2061, 140, -9655, -2356, 7925, 691, -228, 9772, -1100, -31, -286, 8232, 294, 6355, -1348, -223, 9019, 277, -7100, 1233, 2695, 6879, -3499, 7942, 8565, 6034, -7884, 7944, -5079, 262, -7635, -4435, 2712, -8235, -4267, -49, 9170, -5613, 2875, 2874, 2755, -5826, 8568, 1144, 1020, 155, 3828, -1736, 6866, 7145, -1835, 9271, -6706, 7045, 2762, 9335, 2189, -7003, 8864, -335, -4338, 8146, -2712, 8751, -2278, -8402, -5201, 1501, -8385, -9759, 2560, -6262, -6657, 4303, 1627, 304, 6760, -3680, -9292, -2863, 2883, 5562, 1984, 4541, 7860, 7020, -9988, -2184, -2823, 6057, -2055, -4158, 6270, 3259, 9196, 8406, 6428, -5707, 4551, -9178, -6786, 36, -547, -3905, -8289, -1734, -4123, -5804, -9352, -9184, 5473, -2936, -3243, 2298, 6958, -3808, -3159, 3907, 1225, -7137, -6753, 6000, 8733, -2861, -5781, -3335, 5464, 5498, 9004, 4759, 8937, -3087, -9312, -3867, 4869, -7730, 707, -86, 8456, -7721, -9049, 7125, 4791, 9500, -5851, 4501, -4528, 2009, 2570, -3016, -6549, -2539, -9108, -9673, 1351, -4315, 9627, 9121, 699, -6290, -9707, -558, 2895, -6086, 4555, -748, 8270, -7646, 136, -3924, -7209, 2750, 3058, -3389, 5401, 9185, -7458, -3534, -5407, 7681, 4527, 578, -1175, -8993, -7845, 9238, -5648, 5769, 3864, -4228, -57, -4677, -1102, -5900, -1680, 2731, -7439, -5811, 6557, 803, 3720, 1110, 1217, -1008, -4921, 331, 2980, 294, 3579, -5593, 6995, 795, -5611, 100, -1059, 8761, 1085, -9691, -3301, 4182, 6935, 4040, -47, -1895, 74, -3546, -2043, -5589, 4752, 9708, -4873, 4268, 7977, 4604, -1541, 3671, 1693, 9650, 2870, -7288, 7886, 5955, 226, -4512, -82, -715, -6408, -1662, 465, 1584, 6124, -2358, -974, -4652, -6007, 1433, -2715, 6379, 4794, 1781, 8643, -1339, 3710, -6767, 98, 6343, -512, 2618, -8149, -7879, -4552, -6858, -8768, -8356, 6395, -6077, 344, -8067, 1646, -2164, -9437, 5681, -8951, 304, 9136, -6831, 3631, 5637, 8698, -4592, 4684, -7515, -7232, -190, 1942, 7843, 9566, 3005, -8929, -3326, -7938, 4827, 7212, 9474, -7895, 5730, -5522, -4880, -4496, 7074, -599, 573, -4955, 5880, 322, -2772, 2943, 2749, -6392, 8280, -3884, 11, -518, -8718, 5142, -370, 4518, -2897, 5358, 4014, 4388, 3858, 660, -8035, 3166, -4050, -974, 7367, -3862, -9222, -2471, -6437, -9079, -3653, -2618, -2906, 601, -8082, -6192, -9160, 4484, -6736, 8133, 9922, -117, 6649, -61, -9089, 6810, -3859, 1364, 4984, -1608, 8942, 6255, 6488, -8028, 911, -3063, 3683, 4977, -411, -5226, -2898, -7482, -9191, 4888, -9319, -8956, 287, 7199, 9274, 8666, -276, -1883, -2809, 7911, 5170, -912, 1920, -5028, -9124, 8375, 2964, 4612, 2040, 3314, -9954, 6315, 6981, -9351, 5588, 5296, -4346, -6701, -5475, 8870, 8114, -7369, 7146, -3523, 9214, 1544, -6800, -5756, -8360, 748, -593, 9131, -598, 7827, 1433, 1697, 5980, -7868, -3266, -7431, -8095, 225, -7123, 1813, -6290, 8581, 1680, -1983, -4710, -1123, -7656, -2122, -2950, 9730, -8898, -8177, 1481, -9368, 7041, -645, -3150, 2767, -9277, 3988, 649, 70, 4772, -9350, 4925, 7998, -644, 5700, 6429, 8714, 9803, -8260, 3279, -3838, 7486, -3068, 9353, -2983, -1057, 8882, -5249, -1988, 2918, -8978, -7909, 8307, 4929, -8255, -4035, -1703, 5023, 8141, 2475, -3925, -4724, -8830, 6834, -4604, 696, -1809, 3902, 5442, 2363, -97, -9563, -2333, -578, -1962, 9884, -939, -2258, 4235, 5561, -8236, -7820, -2002, 9547, 112, 8298, -2191, 9808, 3373, 8015, -83, -7506, -959, 9528, 3215, -7164, 3442, -440, 2457, 346, -3635, -4654, 7805, -2921, -7816, -3605, -3948, -8006, 2413, -1135, -432, 8759, 2077, 8884, -383, -5677, -7785, -7767, 644, -1058, -5222, 4228, -9947, -2432, -6401, 1766, 7105, 2742, -8183, -8897, -4199, 2212, -7850, -6903, -3226, 3194, 344, 7580, -9838, 2376, 1379, -9842, 7702, 9320, 9998, 1090, -6770, 3551, 6115, -6469, -3497, 843, -5194, 9632, -299, -9053, 8254, -5783, 2720, -6990, 1827, 3493, -9254, 9174, -8639, -8466, 5742, -2636, -2013, 6628, -5915, 877, -6685, 8800, -9199, 5807, 4657, -5444, -9206, 3523, -1868, 4048, 7386, -1903, -3132, -7504, 8296, 7287, 425, -6093, 798, -8816, -8497, 8113, 4714, -9043, 5308, -3617, -6532, 2734, -5211, 4876, 6193, 2773, 9067, -9284, 6015, 3236, 2913, 7917, 9645, 3203, 9684, 4178, 2682, -4923, -2007, 2501, -8711, 4738, -9487, 495, 1156, 1166, -3566, -9545, -6024, -5722, -7182, -1060, 5774, 5362, -890, -8355, -765, 6118, 5677, 700, -6623, 3387, -9232, -1050, 1868, 6935, -6428, 5680, -8872, -5770, 8698, -1207, 3471, 3912, -2603, -9495, -5749, 4803, 4907, 7270, -5394, -733, -1115, -8279, 2704, -8697, -5719, -7015, 5789, -6797, -8976, -4913, -7502, 3974, -6399, -8280, -1161, -8012, -1905, 7805, -2536, -6355, 780, -7792, 4120, -3635, 324, 7622, 3570, 6947, 9220, 6747, 9274, 2248, -3213, -611, -7048, 7361, 9128, -62, -2061, 8607, -4657, 5507, 9546, -862, 8417, -2749, 3158, -6688, 5990, -5, -8969, 9132, -7641, 7742, -6968, -5263, -7855, -315, -1180, -4940, 8357, 5060, 9646, 5288, 7658, -216, -306, 3593, -4052, -7740, -8956, -9831, -6144, -5624, 647, 1504, -1858, 5477, -9896, 9382, 5428, -6223, -1837, -3450, 5850, -8203, 58, 8956, 1018, -232, 7347, -5509, -5628, 2738, -5329, -1481, 6453, -8003, 9035, -4245, -1756, 432, 1198, 1451, 5439, -2391, 6579, 6219, -1254, -7183, 2444, 6844, 3936, 160, 68, 5818, -4909, -9394, -8164, -3130, -1335, -5946, 5211, 214, -7808, -8193, -3610, 8725, 2099, 9657, 2709, -5725, 3155, -2092, -7487, 3907, 2243, 1880, 5314, 6519, 1881, 3734, 2241, 9444, -9911, -597, -3872, 5555, -7466, -2673, -4453, -124, 5600, 5982, -9262, -3915, 6809, -2119, -9290, 7476, 8938, -8233, -7571, 3734, 3538, 4034, 2836, 8728, -6448, 8488, -2067, 1434, -158, -6404, 7677, 5829, -993, 7238, -6485, -8518, 2309, 2519, -5300, 7987, 6154, -8319, -364, -1908, -3419, 1958, 1892, 7671, 1905, 7042, -9341, 4584, -7648, -1074, -5756, 5548, -3028, 8639, 130, -6590, -9210, 8322, -6435, 8199, 5003, 345, 3709, -9289, 9329, 9528, -2256, -9528, 4290, -4688, -9272, -5625, -7897, 304, 3988, 8117, 4028, 6915, 5627, -8593, -3240, -5520, -1615, -7188, -7970, -2187, 9645, -6649, 12, -2921, 5283, -1191, -3037, -6409, 8035, -2576, 6950, 3582, -8236, 9939, -6422, 42, -8556, 519, 4879, -8271, 2358, -9120, -8492, 3297, 7106, -5738, 2455, 2407, -6479, -5977, -8458, -6892, 6609, 973, 6217, 4950, -7372, 3799, -8344, 5011, 3285, 9549, 7907, 8572, 2448, -4009, -8058, 9295, -7809, -8571, -2844, 1273, 3326, -425, -1693, -418, -115, -8179, 4533, -4827, -781, -1846, 1764, 3784, -5689, 2181, -3249, -4998, -5580, -8091, 6539, -1540, 8337, -6127, -7402, -8895, -9773, -3209, 9278, 5432, 8930, 3770, -7974, -2140, 8143, -4806, 2664, -1293, 3540, 4597, 9443, 9078, 251, 3862, 4638, 668, -2191, -4635, 6454, -1633, 5934, -5230, 4452, -803, -6826, 9627, 9521, -1627, 8690, -2394, 5045, -4373, 3625, 6719, 3179, -1315, -3593, 6983, -8696, -2178, -2732, -4349, 2910, -6793, 6052, -6576, 4748, 1488, 4499, 5570, 3613, -9429, 6910, -7145, -6615, 9963, 4643, 8733, 6546, 9326, 9030, -1447, -697, 6755, -7100, -9109, 5442, 6604, -833, 5956, 5372, -7507, 126, 9992, -7576, -339, -3477, 1796, 6435, 4901, 6037, -4022, -6179, 1013, -1688, -7595, -7806, 1469, -7317, -3760, 7635, -8980, -2119, 3303, -6071, -8232, 4706, -4802, 1416, -7503, 3361, 187, 2380, -9883, 3748, -1691, 2113, 7433, 1879, 9502, 607, 5292, 8000, -482, 9608, 6755, -7450, 9570, 2812, -393, -249, -3321, -6348, -2404, 6096, 1258, -1115, -9174, 3506, -7459, 1077, 7495, 5879, -9875, 9662, 7818, -5429, -195, -5021, 4027, 3061, 919, -6490, 5862, 8340, -2279, 7576, -5550, 4334, 4883, -7648, -5266, 6302, -4573, 5768, 4263, -8529, 9608, 3816, 2264, -1037, -8885, 4354, 9402, 6214, -8239, -712, -4672, -5729, -124, -1668, -2448, 5611, 9443, -1509, 7283, 5278, -3585, -9521, -2656, -8710, 7246, 409, 423, 3882, -5752, 1746, -4748, -7283, 3934, -2225, 3944, -4625, -4295, -8468, 8858, -5913, 8639, -8734, -5827, -8508, -2071, -878, -1622, -6234, -6026, -7571, 8016, -6756, -4825, 2082, 7261, -6228, 8119, -8691, 3630, 4429, 9831, 6268, 1257, -9051, -9712, -9462, -3218, 5308, -1464, 7053, -3748, -6735, 1564, 4707, -6219, -5721, 4059, 8812, -2462, 9384, -9348, 6675, 8537, 2166, -7029, -5801, 8613, -4776, -7870, -839, -4955, -2164, -8145, 9735, -9573, 1714, 3684, -7672, -2088, -8600, -6254, -6486, 140, 2604, 5990, -8771, -823, 1457, -4986, -528, 3145, 5515, -5805, 5058, -5171, -9978, -6194, 7324, 9652, -7144, 9464, -4587, -6505, -4318, 3734, -8409, -6998, 8323, 5383, -1597, 8326, 5339, 3467, 2559, 552, -6956, -3186, -2590, 3074, -5636, 9992, 5846, 6322, 9412, -2198, -2141, -9531, 6207, -2514, 78, -7050, 3090, -6955, 5012, -3760, 4680, 4751, -8295, 4304, 1833, -3584, -3644, -6575, 7402, 4467, -7847, 7316, -2126, -2333, 9514, -6793, 903, -6249, 867, -9700, -2609, -707, 8329, -5000, -472, 674, -5585, 2702, -8248, -7498, -1302, 8404, 4321, 663, 1786, 6325, 8299, 6344, 9924, 9587, -8347, -6091, 6731, 6636, 2084, 8715, 6665, -4831, 8426, -4563, 1370, 386, -9126, -1252, -9419, -1106, 3693, -8078, 1493, -9438, 2948, -4656, -6783, -7488, -6202, 662, -4559, 5335, -3265, -4952, 1390, -4061, -3042, 6091, -4321, 415, 5740, -525, 7908, -4164, -49, 9460, 5805, -6760, 4686, -7966, -7406, 318, -9585, 412, -1000, 4554, -9173, -3879, -5076, 9427, -1341, 3110, 5551, -4595, 9484, -8777, 6043, -9073, -7149, -5933, 9191, 6921, 6879, 8301, -9841, -2250, 1201, 6166, -3288, -4325, -3673, 8047, 6357, -3818, 1448, -5513, 4594, 3765, 886, -9816, 3863, 428, 1717, 2345, 8122, -6755, -1617, -677, 1257, 4477, -1834, 4441, -6628, 885, -90, 6619, 6269, -8083, -3706, 4467, -8784, -3649, 3593, -9413, 8167, 1891, -1138, 4451, -4035, -7735, -1506, -3313, 7213, -5927, 9547, 8529, -8641, 2406, -7609, 7065, -7883, 1043, 8459, 4957, -2319, -1872, 3504, 9305, -669, -2621, -9513, -7359, 7640, -1725, -8064, -244, 4217, -2389, 5020, -2475, -9065, 6229, -189, 33, -9926, -8875, 7183, 769, -9376, -5890, -2100, 3646, -5406, 9876, 8943, 8731, -6956, -2815, -1251, 3987, 1147, -6369, 8411, 5854, 3819, 5560, -3569, 1629, 1565, 82, 4762, 8527, 1614, 5104, 3255, -2588, -7469, -5703, -9976, -1631, -7365, -8774, 9102, 2229, -4410, -6024, 7640, -3227, -7017, 1485, 2421, -4756, -2068, -5638, -454, -1105, 5859, 9041, 8292, -7529, 8043, 8521, 5655, -212, 1262, -2963, 494, -9361, 1006, -1428, -9229, -2641, 8167, -5, -792, -16, -5511, -568, 5717, 1029, -4826, -1258, -2071, -471, 7259, -6006, 6110, 9780, -3836, 7579, -8037, 2076, -9820, -159, -2523, -3568, -7124, 799, -7801, -1913, -9820, 4597, -2148, -414, 2116, 7687, -4306, -4482, -2840, 2612, 7492, -8830, 7375, 6816, -5000, 2618, 6013, -6823, -7488, 3570, 2756, 6361, -954, -3977, -7982, -8856, 5899, 860, -5264, 7137, 5150, 9432, -1671, 970, 4107, -4115, 6080, 2727, -5824, -4378, 6474, -8407, -163, 4695, -1147, 9364, -521, 488, 2713, -1998, -4150, -262, 284, -9897, 4980, 4628, 5476, 8515, -566, -5121, -4899, 4491, -828, -7554, 3842, 691, 9354, 9912, 6700, 4778, -2031, 3209, -6804, 6312, -1964, 6102, 8223, 5223, -6853, -4951, -9819, 5864, 4823, 1473, -3079, -988, 6573, -8693, 4319, 6865, 7638, 5351, 4261, -7731, 7400, -4859, -2187, 6544, 5672, 8182, 9, -5885, 8952, -3209, -4038, -160, 3775, -3604, 257, 640, 5780, 3353, -9524, 4660, 7879, 6010, -6596, -356, -1539, 7666, -9110, 3087, -7057, -337, 996, -3608, -4166, -8436, -9291, 5504, 9995, -8896, 6865, 9511, -7065, -889, 5685, -7671, 5560, -6743, 5562, 8502, -4165, 2639, 7938, 6491, 8447, 1064, -9534, 7585, 6374, 5242, 5022, 7322, 2902, 1515, -2392, 4462, 7299, -3757, 4337, 1459, 5117, -8656, -9435, 9811, 2164, -5129, 2844, -4639, -7784, -2240, 4895, -2025, 9403, -1142, 592, 4853, -2513, -1082, 5111, 7051, -5297, -75, 6825, 5285, -2414, -7234, 3263, 9458, -7518, -6048, -5927, -3870, -5965, -3725, -3168, 8449, 6182, -9830, 8013, -7916, 8016, -3089, -1645, 7417, 4454, 1296, 613, 7207, -1232, 1955, 5190, -2397, -8721, -560, -8372, 6864, 4784, -1203, 7151, -8364, 9262, 892, 9886, -2249, -6305, 7404, -2517, 5282, 339, 7639, -7377, 4627, 1291, 2759, -1884, 7264, -3282, -3696, 578, 9485, 7005, -4716, -4952, 9607, 8408, -1399, -267, -7148, 1431, 8832, -783, 852, 4945, -8130, 4062, 1234, 880, 466, 3997, -5434, -7402, 6417, 6983, 3673, -8535, 5024, -3147, -3044, -6693, -6891, 4188, 6773, 6976, -8472, -9566, 1241, 1291, -4599, 2766, 6440, 7014, 7795, -8804, -2050, 7330, 2668, 4633, -5425, 649, 3140, -7250, -7433, 6480, -5549, 5617, -1575, -6627, -1541, 1763, 9153, 6105, -9679, 650, -9913, 2455, 3263, -430, -1017, 4118, -7189, -4126, 5395, -1495, 6000, 5816, -5733, 9128, -8727, -8108, -8922, -6880, 9657, -884, -7462, 2278, -2272, -5954]
k = 532
m = 3

solution = Solution()
print(solution.maxSum(nums, k, m))
